<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ìˆ«ìì•¼êµ¬ (ë‚œì´ë„ ì„ íƒ)</title>
<style>
  :root { color-scheme: dark; }
  html, body { height: 100%; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    overflow-x:hidden;
    color:#f3f3f3;
    /* "íƒ€ìì„ì—ì„œ íˆ¬ìˆ˜ë¥¼ ë°”ë¼ë³´ëŠ”" ëŠë‚Œì˜ ê°„ë‹¨ SVG ë°°ê²½ (ì™¸ë¶€ ì´ë¯¸ì§€ ë¶ˆí•„ìš”) */
    background:
      radial-gradient(1200px 700px at 50% 15%, rgba(255,255,255,.10), rgba(0,0,0,0) 55%),
      radial-gradient(900px 550px at 50% 85%, rgba(0,0,0,.55), rgba(0,0,0,0) 60%),
      url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'>\
  <defs>\
    <linearGradient id='sky' x1='0' x2='0' y1='0' y2='1'>\
      <stop offset='0' stop-color='%230a1733'/>\
      <stop offset='1' stop-color='%23030812'/>\
    </linearGradient>\
    <radialGradient id='glow' cx='50%25' cy='20%25' r='70%25'>\
      <stop offset='0' stop-color='%23ffffff' stop-opacity='0.12'/>\
      <stop offset='1' stop-color='%23ffffff' stop-opacity='0'/>\
    </radialGradient>\
    <linearGradient id='grass' x1='0' x2='0' y1='0' y2='1'>\
      <stop offset='0' stop-color='%231a6b35'/>\
      <stop offset='1' stop-color='%230a3a1c'/>\
    </linearGradient>\
    <linearGradient id='dirt' x1='0' x2='0' y1='0' y2='1'>\
      <stop offset='0' stop-color='%238a5a2b'/>\
      <stop offset='1' stop-color='%2352371f'/>\
    </linearGradient>\
  </defs>\
  <rect width='1600' height='900' fill='url(%23sky)'/>\
  <rect width='1600' height='900' fill='url(%23glow)'/>\
  <!-- ê´€ì¤‘ì„(ì–‘ì¸¡) -->\
  <path d='M0 220 L520 360 L520 520 L0 900 Z' fill='%23060b14' opacity='0.95'/>\
  <path d='M1600 220 L1080 360 L1080 520 L1600 900 Z' fill='%23060b14' opacity='0.95'/>\
  <!-- ì¡°ëª… íƒ€ì›Œ ëŠë‚Œ -->\
  <g opacity='0.25'>\
    <rect x='130' y='110' width='18' height='170' fill='%23cfd6ff'/>\
    <rect x='1450' y='110' width='18' height='170' fill='%23cfd6ff'/>\
    <circle cx='139' cy='105' r='26' fill='%23cfd6ff' opacity='0.55'/>\
    <circle cx='1459' cy='105' r='26' fill='%23cfd6ff' opacity='0.55'/>\
  </g>\
  <!-- í•„ë“œ(ì›ê·¼) -->\
  <path d='M120 560 Q800 360 1480 560 L1600 900 L0 900 Z' fill='url(%23grass)'/>\
  <!-- ë‚´ì•¼ í™ -->\
  <path d='M520 650 Q800 520 1080 650 Q800 740 520 650 Z' fill='url(%23dirt)' opacity='0.95'/>\
  <!-- ë² ì´ìŠ¤ ë¼ì¸(ì›ê·¼) -->\
  <path d='M800 720 L800 560' stroke='%23f2f2f2' stroke-opacity='0.35' stroke-width='4'/>\
  <path d='M720 660 L800 560 L880 660' fill='none' stroke='%23f2f2f2' stroke-opacity='0.30' stroke-width='4'/>\
  <!-- í™ˆí”Œë ˆì´íŠ¸(íƒ€ìì„ ì‹œì  ê·¼ì²˜) -->\
  <path d='M790 770 L810 770 L820 786 L800 802 L780 786 Z' fill='%23f2f2f2' opacity='0.55'/>\
  <!-- íˆ¬ìˆ˜ ë§ˆìš´ë“œ -->\
  <ellipse cx='800' cy='600' rx='46' ry='18' fill='%23cfae8a' opacity='0.65'/>\
  <!-- í¬ë¯¸í•œ ë„¤íŠ¸ -->\
  <g opacity='0.12'>\
    <path d='M0 520 Q800 420 1600 520' stroke='%23ffffff' stroke-width='2'/>\
    <path d='M0 560 Q800 460 1600 560' stroke='%23ffffff' stroke-width='2'/>\
    <path d='M0 600 Q800 500 1600 600' stroke='%23ffffff' stroke-width='2'/>\
  </g>\
</svg>");
    background-size: cover;
    background-position: center;
  }

  .wrap{
    max-width: 860px;
    margin: 28px auto 60px;
    padding: 18px;
  }

  .glass{
    background: rgba(10, 12, 18, 0.68);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 16px;
    box-shadow: 0 14px 60px rgba(0,0,0,0.45);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  h1{ margin: 0 0 10px; font-size: 28px; letter-spacing: 0.02em; }
  p{ margin: 8px 0; color: rgba(255,255,255,0.85); line-height: 1.55; }

  .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .space{ justify-content: space-between; }

  .btn{
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color: #fff;
    cursor:pointer;
    font-size: 16px;
  }
  .btn:hover{ background: rgba(255,255,255,0.12); }

  .btn.primary{
    background: rgba(255,255,255,0.16);
    border-color: rgba(255,255,255,0.24);
    font-weight: 700;
  }

  .select{
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.25);
    color:#fff;
    font-size: 15px;
  }

  .input{
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.25);
    color:#fff;
    font-size: 18px;
    width: 170px;
    letter-spacing: 0.22em;
  }
  .hint{ font-size: 13px; color: rgba(255,255,255,0.72); margin-top: 6px; }

  .panel{ padding: 16px; }

  .status{
    margin-top: 10px;
    font-weight: 800;
    font-size: 16px;
  }
  .status.win{ color: #7dff9c; }
  .status.lose{ color: #ff7676; }
  .muted{ color: rgba(255,255,255,0.72); font-weight: 600; }

  table{ width:100%; border-collapse: collapse; margin-top: 14px; }
  th, td{ padding: 10px 8px; border-bottom: 1px solid rgba(255,255,255,0.10); text-align: left; }
  th{ font-size: 13px; color: rgba(255,255,255,0.70); }

  #gameArea{ display:none; }
  #startScreen{ text-align:center; padding: 18px; }

  /* ìŠ¹ë¦¬ ì• ë‹ˆë©”ì´ì…˜ ìº”ë²„ìŠ¤ ì˜¤ë²„ë ˆì´ */
  #fxLayer{
    position: fixed;
    inset: 0;
    pointer-events: none;
    display:none;
  }
</style>
</head>

<body>
<canvas id="fxLayer"></canvas>

<div class="wrap">
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="startScreen" class="glass panel">
    <h1>âš¾ ìˆ«ìì•¼êµ¬</h1>
    <p>
      ê·œì¹™: ê°™ì€ ìë¦¬ ê°™ì€ ìˆ«ì = <b>ìŠ¤íŠ¸ë¼ì´í¬</b>, ë‹¤ë¥¸ ìë¦¬ ê°™ì€ ìˆ«ì = <b>ë³¼</b>, ì •ë‹µì— ì•„ì˜ˆ ì—†ëŠ” ìˆ«ì ê°œìˆ˜ = <b>ì•„ì›ƒ</b><br/>
      â€» 0~9 ì‚¬ìš© ê°€ëŠ¥, <b>ì¤‘ë³µ ì—†ìŒ</b>, ì…ë ¥ì€ ìë¦¿ìˆ˜ ê³ ì •(ì•ìë¦¬ì— 0 ê°€ëŠ¥)
    </p>

    <div class="row" style="justify-content:center; margin-top:14px;">
      <label class="muted">ë‚œì´ë„</label>
      <select id="difficulty" class="select">
        <option value="easy">ì‰¬ì›€ (3ìë¦¬ / 20íšŒ)</option>
        <option value="normal" selected>ë³´í†µ (4ìë¦¬ / 10íšŒ)</option>
        <option value="hard">ì–´ë ¤ì›€ (4ìë¦¬ / 5íšŒ)</option>
      </select>
    </div>

    <div style="margin-top:18px;">
      <button class="btn primary" id="startBtn">ìˆ«ìì•¼êµ¬ START!</button>
    </div>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div id="gameArea" class="glass panel">
    <div class="row space">
      <h1 style="margin:0;">âš¾ ìˆ«ìì•¼êµ¬</h1>
      <div class="row">
        <span class="muted" id="modeLabel"></span>
        <button class="btn" id="restartBtn">ìƒˆ ê²Œì„</button>
        <button class="btn" id="backBtn">ë‚œì´ë„ ì„ íƒ</button>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <input id="guess" class="input" inputmode="numeric" autocomplete="off" />
      <button class="btn primary" id="submitBtn">í™•ì¸</button>
      <span class="muted">ì‹œë„: <span id="tryCount">0</span> / <span id="tryLimit">0</span></span>
    </div>
    <div class="hint" id="ruleHint"></div>

    <div class="status" id="status">ê²Œì„ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>

    <table>
      <thead>
        <tr>
          <th style="width:80px;">#</th>
          <th style="width:140px;">ì…ë ¥</th>
          <th>ê²°ê³¼</th>
        </tr>
      </thead>
      <tbody id="log"></tbody>
    </table>
  </div>
</div>

<script>
"use strict";

/* =========================
   ë‚œì´ë„ ì„¤ì •
========================= */
const MODES = {
  easy:   { length: 3, maxTry: 20, label: "ì‰¬ì›€ Â· 3ìë¦¬ Â· 20íšŒ" },
  normal: { length: 4, maxTry: 10, label: "ë³´í†µ Â· 4ìë¦¬ Â· 10íšŒ" },
  hard:   { length: 4, maxTry:  5, label: "ì–´ë ¤ì›€ Â· 4ìë¦¬ Â· 5íšŒ" },
};

let modeKey = "normal";
let LENGTH = MODES[modeKey].length;
let MAX_TRY = MODES[modeKey].maxTry;

let answer = [];
let tries = 0;
let gameOver = true;

/* =========================
   DOM
========================= */
const $startScreen = document.getElementById("startScreen");
const $gameArea = document.getElementById("gameArea");

const $difficulty = document.getElementById("difficulty");
const $startBtn = document.getElementById("startBtn");

const $modeLabel = document.getElementById("modeLabel");
const $restartBtn = document.getElementById("restartBtn");
const $backBtn = document.getElementById("backBtn");

const $guess = document.getElementById("guess");
const $submitBtn = document.getElementById("submitBtn");

const $status = document.getElementById("status");
const $tryCount = document.getElementById("tryCount");
const $tryLimit = document.getElementById("tryLimit");
const $ruleHint = document.getElementById("ruleHint");
const $log = document.getElementById("log");

/* =========================
   ì •ë‹µ ìƒì„± (0~9, ì¤‘ë³µ ì—†ìŒ)
========================= */
function generateAnswer(len){
  const nums = [...Array(10).keys()]; // 0~9
  for(let i=nums.length-1;i>0;i--){
    const j = Math.floor(Math.random() * (i+1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  return nums.slice(0, len);
}

/* =========================
   UI helpers
========================= */
function setStatus(msg, cls=""){
  $status.className = "status " + cls;
  $status.textContent = msg;
}
function setStatusHTML(html, cls=""){
  $status.className = "status " + cls;
  $status.innerHTML = html;
}
function resetLog(){
  $log.innerHTML = "";
}
function prependLogRow(n, guessStr, resultStr){
  $log.insertAdjacentHTML("afterbegin",
    `<tr><td>${n}</td><td>${guessStr}</td><td>${resultStr}</td></tr>`
  );
}

/* =========================
   í™”ë©´ ì „í™˜
========================= */
function showStart(){
  $gameArea.style.display = "none";
  $startScreen.style.display = "block";
  gameOver = true;
}
function showGame(){
  $startScreen.style.display = "none";
  $gameArea.style.display = "block";
}

/* =========================
   ê²Œì„ ì‹œì‘
========================= */
function startGame(selectedModeKey){
  modeKey = selectedModeKey;
  LENGTH = MODES[modeKey].length;
  MAX_TRY = MODES[modeKey].maxTry;

  answer = generateAnswer(LENGTH);
  tries = 0;
  gameOver = false;

  showGame();

  $modeLabel.textContent = MODES[modeKey].label;
  $tryCount.textContent = "0";
  $tryLimit.textContent = String(MAX_TRY);

  $guess.value = "";
  $guess.maxLength = LENGTH;
  $guess.placeholder = LENGTH === 3 ? "ì˜ˆ: 507" : "ì˜ˆ: 5072";

  resetLog();
  setStatus("ê²Œì„ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

  $ruleHint.textContent =
    `ê·œì¹™: ${LENGTH}ìë¦¬(0~9), ì¤‘ë³µ ì—†ìŒ Â· ê²°ê³¼ëŠ” S(ìŠ¤íŠ¸ë¼ì´í¬) B(ë³¼) O(ì•„ì›ƒ)`;

  $guess.focus();

  // ë””ë²„ê·¸ í•„ìš” ì‹œ:
  // console.log("ì •ë‹µ:", answer.join(""));
}

/* =========================
   íŒì •: S / B / O
   - O(ì•„ì›ƒ) = ì •ë‹µì— ì—†ëŠ” ìˆ«ì ê°œìˆ˜
========================= */
function judge(inputArr){
  let strike = 0, ball = 0, out = 0;
  for(let i=0;i<LENGTH;i++){
    if(inputArr[i] === answer[i]) strike++;
    else if(answer.includes(inputArr[i])) ball++;
    else out++;
  }
  return { strike, ball, out };
}

/* =========================
   ì…ë ¥ ê²€ì¦
========================= */
function parseGuess(str){
  const s = (str || "").trim();
  const re = new RegExp("^\\d{" + LENGTH + "}$");
  if(!re.test(s)) return { ok:false, reason:`${LENGTH}ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.` };

  const arr = [...s].map(Number);
  if(new Set(arr).size !== LENGTH) return { ok:false, reason:"ì¤‘ë³µ ìˆ«ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." };

  return { ok:true, arr, s };
}

/* =========================
   ì œì¶œ
========================= */
function submit(){
  if(gameOver) return;

  const parsed = parseGuess($guess.value);
  if(!parsed.ok){
    setStatus(parsed.reason, "lose");
    $guess.focus();
    $guess.select();
    return;
  }

  tries++;
  $tryCount.textContent = String(tries);

  const { strike, ball, out } = judge(parsed.arr);
  const resultStr = `${strike}S ${ball}B ${out}O`;

  prependLogRow(tries, parsed.s, resultStr);

  if(strike === LENGTH){
    gameOver = true;
    setStatusHTML(`ğŸ‰ ì •ë‹µ! <b>${answer.join("")}</b> Â· ${tries}ë²ˆ ë§Œì— ì„±ê³µ`, "win");
    playHitEffect(); // ìŠ¹ë¦¬ íš¨ê³¼
  } else if(tries >= MAX_TRY){
    gameOver = true;
    setStatusHTML(`âŒ ì‹¤íŒ¨! ì •ë‹µ: <b>${answer.join("")}</b>`, "lose");
  } else {
    setStatus(`ê²°ê³¼: ${resultStr} â€” ê³„ì† ë„ì „í•˜ì„¸ìš”.`);
  }

  $guess.value = "";
  $guess.focus();
}

/* =========================
   ì´ë²¤íŠ¸ ë°”ì¸ë”©
========================= */
$startBtn.addEventListener("click", () => startGame($difficulty.value));
$restartBtn.addEventListener("click", () => startGame(modeKey));
$backBtn.addEventListener("click", showStart);

$submitBtn.addEventListener("click", submit);
$guess.addEventListener("keydown", (e) => { if(e.key === "Enter") submit(); });

// UX: ìˆ«ìë§Œ, ìµœëŒ€ LENGTH
$guess.addEventListener("input", () => {
  $guess.value = $guess.value.replace(/[^\d]/g, "").slice(0, LENGTH);
});

/* =========================
   ìŠ¹ë¦¬ ì´í™íŠ¸: ë°°íŠ¸ ìŠ¤ìœ™ + ê³µ ë¹„í–‰(ìº”ë²„ìŠ¤)
   - ê°„ë‹¨í•œ ë„í˜• ì• ë‹ˆë©”ì´ì…˜ (ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ì—†ìŒ)
========================= */
const fx = document.getElementById("fxLayer");
const ctx = fx.getContext("2d");

function resizeFx(){
  fx.width = window.innerWidth * devicePixelRatio;
  fx.height = window.innerHeight * devicePixelRatio;
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener("resize", resizeFx);
resizeFx();

function playHitEffect(){
  fx.style.display = "block";

  const W = window.innerWidth;
  const H = window.innerHeight;

  // ì‹œì‘ ìœ„ì¹˜(ë°°íŠ¸/ê³µ): í™”ë©´ í•˜ë‹¨ ì¤‘ì•™ ì•½ê°„ ì˜¤ë¥¸ìª½ (íƒ€ì ìœ„ì¹˜)
  const batBase = { x: W*0.58, y: H*0.78 };
  const ball0   = { x: W*0.55, y: H*0.72 };

  // ëª©í‘œ(ê³µì´ ë‚ ì•„ê°€ëŠ” ë°©í–¥): ì¢Œìƒë‹¨ ê´€ì¤‘ì„ ë°©í–¥
  const target  = { x: W*0.18, y: H*0.22 };

  let t0 = performance.now();
  const dur = 1300; // ms

  // íŒŒí‹°í´(ìŠ¤íŒŒí¬)
  const sparks = Array.from({length: 20}, () => ({
    x: ball0.x, y: ball0.y,
    vx: (Math.random()*2-1)*250,
    vy: (Math.random()*-1)*280,
    life: 0.6 + Math.random()*0.4
  }));

  function drawBat(progress){
    // ë°°íŠ¸: ê°ˆìƒ‰ ë¼ì¸+ì†ì¡ì´, íšŒì „ ìŠ¤ìœ™
    const swing = -1.0 + 1.8 * Math.min(1, progress*1.3); // -1rad -> +0.8rad
    const len = Math.min(W,H)*0.18;

    ctx.save();
    ctx.translate(batBase.x, batBase.y);
    ctx.rotate(swing);

    // ë°°íŠ¸ ëª¸í†µ
    ctx.lineWidth = 14;
    ctx.strokeStyle = "rgba(210,170,120,0.92)";
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(-len, -len*0.25);
    ctx.stroke();

    // ì†ì¡ì´
    ctx.lineWidth = 18;
    ctx.strokeStyle = "rgba(70,40,20,0.95)";
    ctx.beginPath();
    ctx.moveTo(10,10);
    ctx.lineTo(-25, 35);
    ctx.stroke();

    ctx.restore();
  }

  function drawBall(x,y,scale,trail){
    // íŠ¸ë ˆì¼
    if(trail){
      ctx.strokeStyle = "rgba(255,255,255,0.25)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(trail.x1, trail.y1);
      ctx.lineTo(trail.x2, trail.y2);
      ctx.stroke();
    }

    // ê³µ
    ctx.save();
    ctx.translate(x,y);
    ctx.scale(scale, scale);
    ctx.fillStyle = "rgba(245,245,245,0.95)";
    ctx.beginPath();
    ctx.arc(0,0,10,0,Math.PI*2);
    ctx.fill();

    // ì‹¤ë°¥
    ctx.strokeStyle = "rgba(210,70,70,0.85)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(-2,1,7, -0.2, 1.0);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(2,-1,7, 2.1, 3.3);
    ctx.stroke();
    ctx.restore();
  }

  function drawText(progress){
    const a = Math.max(0, Math.min(1, (progress-0.2)/0.5));
    ctx.save();
    ctx.globalAlpha = 0.9*a;
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.font = "800 34px system-ui, sans-serif";
    ctx.fillText("HIT!", W*0.07, H*0.12);
    ctx.restore();
  }

  function step(now){
    const elapsed = now - t0;
    const p = Math.min(1, elapsed / dur);

    ctx.clearRect(0,0,W,H);

    // ì•½ê°„ì˜ í™”ë©´ ë¹„ë„¤íŒ…
    ctx.fillStyle = "rgba(0,0,0,0.18)";
    ctx.fillRect(0,0,W,H);

    // ë°°íŠ¸(ì´ˆë°˜ ìŠ¤ìœ™)
    drawBat(p);

    // ê³µ ê¶¤ì : 2ì°¨ ë² ì§€ì–´ë¡œ "í›…" ëŠë‚Œ
    const cx = (ball0.x + target.x)/2 + W*0.08; // ì»¨íŠ¸ë¡¤
    const cy = (ball0.y + target.y)/2 - H*0.20;

    // ë² ì§€ì–´ ìœ„ì¹˜
    const x = (1-p)*(1-p)*ball0.x + 2*(1-p)*p*cx + p*p*target.x;
    const y = (1-p)*(1-p)*ball0.y + 2*(1-p)*p*cy + p*p*target.y;

    // íŠ¸ë ˆì¼: ì§ì „ í”„ë ˆì„ ê·¼ì‚¬
    const p2 = Math.max(0, p-0.02);
    const x2 = (1-p2)*(1-p2)*ball0.x + 2*(1-p2)*p2*cx + p2*p2*target.x;
    const y2 = (1-p2)*(1-p2)*ball0.y + 2*(1-p2)*p2*cy + p2*p2*target.y;

    // ìŠ¤ì¼€ì¼: ë©€ì–´ì§€ë©´ì„œ ì‘ì•„ì§
    const scale = 1 - 0.65*p;

    // ì¶©ëŒ ìˆœê°„(ì´ˆë°˜ 25%)ì— ìŠ¤íŒŒí¬
    if(p < 0.35){
      const spP = Math.max(0, (p-0.08)/0.22);
      const alpha = 1 - spP;
      ctx.save();
      ctx.globalAlpha = 0.9*alpha;
      ctx.strokeStyle = "rgba(255,230,170,0.95)";
      ctx.lineWidth = 2;
      for(const s of sparks){
        ctx.beginPath();
        ctx.moveTo(ball0.x, ball0.y);
        ctx.lineTo(ball0.x + s.vx*spP*0.08, ball0.y + s.vy*spP*0.08);
        ctx.stroke();
      }
      ctx.restore();
    }

    drawBall(x,y,scale, {x1:x2, y1:y2, x2:x, y2:y});
    drawText(p);

    if(p < 1){
      requestAnimationFrame(step);
    } else {
      // ë§ˆë¬´ë¦¬ í˜ì´ë“œì•„ì›ƒ
      const fadeStart = performance.now();
      const fadeDur = 350;
      function fade(n2){
        const fp = Math.min(1, (n2 - fadeStart)/fadeDur);
        ctx.clearRect(0,0,W,H);
        ctx.fillStyle = `rgba(0,0,0,${0.18*(1-fp)})`;
        ctx.fillRect(0,0,W,H);
        if(fp < 1) requestAnimationFrame(fade);
        else fx.style.display = "none";
      }
      requestAnimationFrame(fade);
    }
  }

  requestAnimationFrame(step);
}

// ì´ˆê¸° í™”ë©´ì€ ì‹œì‘ í™”ë©´
showStart();
</script>
</body>
</html>
